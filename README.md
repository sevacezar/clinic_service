# API сервиса клиники
## Структура репозитория
1. `/code` - главная директория сервиса
    - `/auth` - функциональный компонет приложения: авторизация
    - `/patients` - функциональный компонент приложения: 
    - `config.py` - общие конфигурационные данные приложения
    - `database.py` - конфигурация БД Postgres
    - `dependencies.py` - общие зависимости FastAPI
    - `main.py` - точка запуска приложения
2. `/docker` - директория контейнеризации
    - `.dockerignore` - перечень игнорируемых файлы для контейров
    - `docker-compose.yaml` - файл запуска контейнеров БД и приложения
    - `Dockerfile` - файл-сборщик image FastAPI-приложения
3. `/migrations` - директория с миграциями Alembic
4. `/requirements` - директория с зависимостями проекта
    - `requirements_dev.py` - зависимости для разработки и тестирования
    - `requirements_prod.py` - зависимости для деплоя
5. `/tests` - интеграционные тесты приложения Pytest
6. `.env.template` - шаблон файла с переменными окружения
7. `.gitignore` - перечень игнорируемых файлов для контроля версий
8. `alembic.ini` - конфигурационный файл миграций Alembic
9. `pytest.ini` - конфигурационный файл тестирования Pytest
10. `README.md` - документация по структуре и запуску приложения
11. `wait-for-it.sh` - скрипт для запуска приложения только после инициализации БД

## Инструкции по локальному запуску

### 1. Клонирование репозитория
```python
$ git clone https://github.com/sevacezar/clinic_service.git
```
### 2. Настройка переменных окружения
1. Переименуйте файл `.env.template` в `.env` и заполните значениями переменные окружения

### 3. Запуск тестов
1. Установка зависимостей для тестирования
```python 
    $ pip install --upgrade pip -r requirements/requirements_dev.txt
```
2. Запуск тестовой БД
```python 
    $ cd tests/docker  #  переход в директорию с файлом запуска контейнера
    $ docker compose up --build  #  запуск контейнера БД
```
3. Запуск тестов с выводом статистики покрытия кода тестами
```python
    $ cd ../..  # возврат в директорию с проектом
    $ pytest --cov=code  # запуск тестов с визуализацией степени покрытия
```

### 4. Запуск приложения
```python 
    $ cd docker/  #  переход в директорию с файлом запуска контейнера
    $ docker compose up --build  #  запуск приложения с БД
```

### 5. Информация об использовании API
#### Сервис предоставляет взаимодействие с двумя эндпойнтами:
1. `/login` - по URL отправляется POST-запрос с данными аутентификации: username и password. При успешной аутентификации возвращается JWT-токен, который далее необходимо отправлять на другие URL, требующие взаимодействие только с аутентифицированными пользователями и пользователями, обладающими определенными правами на использование ресурсов.
2. `/patients` - по URL отправляется GET-запрос с JWT-токеном в хедере: `Authorization: Bearer <token>`. Ресурс доступен для пользователей с ролью `doctor`. При успешной выполнении запроса возвращается список пациентов с диагнозами.

Схемы входных и выходных данных вышеупомянутых запросов, а также тестирование API, доступно по URL `http://127.0.0.1:8000/docs` в Swagger при условии запуска приложения (шаг 3 настоящей инструкции).